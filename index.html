<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="dual-type-simple.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script src="assets/background.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <script src="index.js" defer></script>
    <script src="dual-type-simple.js" defer></script>
    <script src="mask-manager.js" defer></script> <script src="card-download.js" defer></script>
    <script src="custom-drag-drop.js" defer></script>
    <script src="storage-helper.js" defer></script>

    <title>Pokémon Template Maker</title>

    <style>
        /* Fix content positioning and layering */
        .card {
            position: relative !important; /* [cite: 88] */
        }

        .card-container {
            display: block !important; /* [cite: 89] */
            position: relative !important; /* [cite: 90] */
            z-index: 5 !important; /* Ensure content is above background layers [cite: 90] */
        }

        .card-top,
        .card-bottom {
            position: relative !important; /* [cite: 90] */
            z-index: 6 !important; /* [cite: 91] */
        }

        /* Fix name and HP */
        .card-name {
            position: relative !important; /* [cite: 91] */
            font-size: min(33.6px, 2.1vw) !important; /* [cite: 92] */
            transform: scaleX(0.9) translateX(-7%) !important; /* [cite: 92] */
            z-index: 7 !important; /* [cite: 92] */
        }

        .hp-container {
            position: relative !important; /* [cite: 93] */
            top: 0.1vw !important; /* [cite: 94] */
            z-index: 7 !important; /* [cite: 94] */
        }

        .card-hp {
            position: relative !important; /* [cite: 94] */
            font-size: min(4.8px, 0.3vw) !important; /* [cite: 95] */
            font-family: 'Lato', 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif !important; /* [cite: 95] */
            display: inline-block !important; /* [cite: 95] */
            left: 0.35vw !important; /* [cite: 96] */
        }

        .hp {
            font-size: min(28.8px, 1.8vw) !important; /* [cite: 96] */
            font-family: 'Plus Jakarta Sans', sans-serif !important; /* [cite: 97] */
            transform: scaleX(0.9) translateX(5%) !important; /* [cite: 97] */
            font-weight: bold !important; /* [cite: 97] */
            display: inline-block !important; /* [cite: 97] */
        }

        /* Ensure attacks and footer are above background */
        .attack, .card-footer {
            position: relative !important; /* [cite: 98] */
            z-index: 7 !important; /* [cite: 99] */
        }

        /* Ensure card layers render in the correct order */
        #second-card-layer {
            z-index: 1 !important; /* Above base card but below content [cite: 99] */
        }

        #custom-bg-layer {
            z-index: 0 !important; /* Bottom layer [cite: 100] */
        }

        /* Fix any specific text elements */
        .attack-name, .attack-damage, .attack-text {
            position: relative !important; /* [cite: 101] */
            z-index: 8 !important; /* [cite: 102] */
        }

        .card-footer p,
        .card-footer div {
            position: relative !important; /* [cite: 102] */
            z-index: 8 !important; /* [cite: 103] */
        }

        /* Responsive improvements (kept from original) */
        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 1fr; /* [cite: 103] */
                height: auto; /* [cite: 104] */
            }

            .input-container {
                width: 100%; /* [cite: 104] */
                max-width: 600px; /* [cite: 105] */
                margin: 0 auto; /* [cite: 105] */
            }

            .img-container {
                margin: 20px auto; /* [cite: 105] */
            }

            .img-drop-container {
                margin: 20px auto; /* [cite: 106] */
                position: static; /* [cite: 106] */
                top: 0; /* [cite: 107] */
            }
        }
        /* Removed Tab Interface Styles */

        /* Card templates (kept from original) */
        .template-selection {
            display: grid; /* [cite: 114] */
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); /* [cite: 115] */
            gap: 10px; /* [cite: 115] */
            margin-top: 15px; /* [cite: 115] */
        }

        .card-template {
            text-align: center; /* [cite: 115] */
            cursor: pointer; /* [cite: 116] */
            transition: 0.3s; /* [cite: 116] */
            padding: 10px; /* [cite: 116] */
            border-radius: 5px; /* [cite: 116] */
            background: rgba(255,255,255,0.1); /* [cite: 116] */
        }

        .card-template:hover {
            background: rgba(255,255,255,0.2); /* [cite: 117] */
        }

        .card-template img {
            width: 100%; /* [cite: 118] */
            border-radius: 5px; /* [cite: 119] */
        }

        /* Action buttons (kept from original) */
        .action-buttons {
            display: flex; /* [cite: 119] */
            flex-wrap: wrap; /* [cite: 120] */
            gap: 10px; /* [cite: 120] */
            margin-top: 15px; /* [cite: 120] */
        }

        .action-button {
            padding: 8px 15px; /* [cite: 120] */
            border: none; /* [cite: 121] */
            border-radius: 5px; /* [cite: 121] */
            cursor: pointer; /* [cite: 121] */
            background-color: var(--darkblue); /* [cite: 121] */
            color: white; /* [cite: 121] */
            transition: 0.3s; /* [cite: 121] */
        }

        .action-button:hover {
            background-color: #0b5ca0; /* [cite: 122] */
        }

        /* Holographic effect toggle (kept from original) */
        .holo-toggle {
            display: flex; /* [cite: 123] */
            align-items: center; /* [cite: 124] */
            margin: 15px 0; /* [cite: 124] */
        }

        .holo-toggle label {
            margin-right: 10px; /* [cite: 124] */
            color: white; /* [cite: 125] */
        }

        /* Card gallery (kept from original) */
        .card-gallery {
            display: grid; /* [cite: 125] */
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); /* [cite: 126] */
            gap: 15px; /* [cite: 126] */
            margin-top: 15px; /* [cite: 126] */
        }

        .gallery-item {
            position: relative; /* [cite: 126] */
            border-radius: 10px; /* [cite: 127] */
            overflow: hidden; /* [cite: 127] */
            box-shadow: 0 3px 10px rgba(0,0,0,0.2); /* [cite: 127] */
            transition: 0.3s; /* [cite: 127] */
        }

        .gallery-item:hover {
            transform: translateY(-5px); /* [cite: 128] */
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); /* [cite: 129] */
        }

        .gallery-item img {
            width: 100%; /* [cite: 129] */
            display: block; /* [cite: 130] */
        }

        .gallery-item-actions {
            position: absolute; /* [cite: 130] */
            bottom: 0; /* [cite: 131] */
            left: 0; /* [cite: 131] */
            right: 0; /* [cite: 131] */
            background: rgba(0,0,0,0.7); /* [cite: 131] */
            display: flex; /* [cite: 131] */
            justify-content: space-around; /* [cite: 131] */
            padding: 5px; /* [cite: 131] */
            opacity: 0; /* [cite: 131] */
            transition: 0.3s; /* [cite: 131] */
        }

        .gallery-item:hover .gallery-item-actions {
            opacity: 1; /* [cite: 132] */
        }

        .gallery-action {
            color: white; /* [cite: 133] */
            background: transparent; /* [cite: 134] */
            border: none; /* [cite: 134] */
            cursor: pointer; /* [cite: 134] */
            font-size: 14px; /* [cite: 134] */
        }

        /* NEW MASK SELECTOR STYLE */
        .mask-selection-container {
            margin: 15px auto;
            width: 90%;
            max-width: 378px;
        }
        .mask-selection-container label {
            display: block;
            margin-bottom: 5px;
            color: white;
            text-shadow: 1px 0 1px #1365b3, 0 1px 1px #1365b3;
        }
        #mask-selector {
            width: 100%;
            padding: 5px;
            background-color: white;
            box-shadow: 0 0 15px var(--darkblue) inset;
            border: 1px solid white;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12pt;
            height: 35px; /* Consistent height */
        }
        #mask-selector:focus {
            outline: 1px solid var(--yellow);
            border: 1px solid var(--yellow);
            box-shadow: none;
        }
    </style>
</head>
<body>
    <div id="threejs-bg"></div>
    <div class="container">
        <div class="input-container">
            <img id="logo" src="img/logo.png" alt="Pokemon Card Maker Logo"> <div id="pokemon-info-section"> <div id="name-container">
                    <label for="name">Name:</label>
                    <input type="text" id="name" name="name" maxlength="20"> <label for="hp">HP:</label>
                    <input type="number" id="hp" name="hp" min="10" max="340" step="10"> </div>

                <div class="stage-input">
                    <div id="stage-dropdown" class="input-header closed"> <h2>Stage:</h2>
                        <div class="arrowbox"> <i id="stage-arrow" class="arrow down"></i> </div>
                    </div>
                    <div id="stage-body" class="input-body"> <div>
                            <label for="stage">Stage:</label>
                            <select id="stage" name="stage"> <option value="basic">Basic</option>
                                <option value="stage-1">Stage 1</option> <option value="stage-2">Stage 2</option>
                            </select>
                        </div>
                        <div>
                            <label for="evolves-from">Evolves from:</label>
                            <input type="text" id="evolves-from" name="evolves-from" maxlength="20"> </div>
                    </div>
                </div>

                <div class="stats-input">
                    <div id="stats-dropdown" class="input-header closed"> <h2>Stats:</h2>
                        <div class="arrowbox"> <i id="stats-arrow" class="arrow down"></i> </div>
                    </div>
                    <div id="stats-body" class="input-body"> <div>
                            <label for="category">Category:</label>
                            <input type="text" id="category" name="category"> </div>
                        <div>
                            <label for="pokedex-number">Pokedex:</label>
                            <input type="number" id="pokedex-number" name="pokedex-number"> </div>
                        <div class="input-bottom"> <div class="height-div">
                                <p class="ht">HT:</p> <input type="number" id="feet" name="feet"><br>
                                <label for="feet">'</label>
                                <input type="number" id="inches" name="inches"><br> <label for="inches">"</label>
                            </div>
                            <div class="weight-div"> <label for="weight">WT:</label>
                                <input type="number" id="weight" name="weight"> <p>lbs</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="holo-toggle"> <label for="holo-effect">Holographic Effect:</label>
                    <input type="checkbox" id="holo-effect" name="holo-effect">
                </div>

                <div class="action-buttons"> <button id="save-progress" class="action-button">Save Progress</button>
                    <button id="load-progress" class="action-button">Load Last Save</button> <button id="export-data" class="action-button">Export Data</button>
                    <button id="import-data" class="action-button">Import Data</button>
                    <button id="reset-card" class="action-button">Reset Card</button> </div>
            </div>

            <div id="card-types-section"> <h3>Primary Type</h3> <div id="type-selector">
                    <ul id="type-list">
                        <li value="grass" class="select-type"><img src="img/grass.png" alt="grass"></li> <li value="water" class="select-type"><img src="img/water.png" alt="water"></li> <li value="fire" class="select-type"><img src="img/fire.png" alt="fire"></li>
                        <li value="normal" class="select-type"><img src="img/normal.png" alt="normal"></li>
                        <li value="electric" class="select-type"><img src="img/electric.png" alt="electric"></li> <li value="psychic" class="select-type"><img src="img/psychic.png" alt="psychic"></li>
                        <li value="fighting" class="select-type"><img src="img/fighting.png" alt="fighting"></li>
                        <li value="dark" class="select-type"><img src="img/dark.png" alt="dark"></li> <li value="metal" class="select-type"><img src="img/metal.png" alt="metal"></li>
                    </ul>
                </div>

                <div id="dual-type-container"> <div class="type-toggle">
                        <label for="dual-type-toggle">Dual Type:</label>
                        <input type="checkbox" id="dual-type-toggle" name="dual-type-toggle"> </div>
                    <div id="second-type-selector" class="hidden"> <p>Second Type:</p> <ul id="second-type-list">
                            <li value="grass" class="select-second-type"><img src="img/grass.png" alt="grass"></li>
                            <li value="water" class="select-second-type"><img src="img/water.png" alt="water"></li> <li value="fire" class="select-second-type"><img src="img/fire.png" alt="fire"></li>
                            <li value="normal" class="select-second-type"><img src="img/normal.png" alt="normal"></li>
                            <li value="electric" class="select-second-type"><img src="img/electric.png" alt="electric"></li> <li value="psychic" class="select-second-type"><img src="img/psychic.png" alt="psychic"></li>
                            <li value="fighting" class="select-second-type"><img src="img/fighting.png" alt="fighting"></li> <li value="dark" class="select-second-type"><img src="img/dark.png" alt="dark"></li>
                            <li value="metal" class="select-second-type"><img src="img/metal.png" alt="metal"></li>
                        </ul>
                    </div>
                </div>

                <div class="mask-selection-container">
                    <label for="mask-selector">Type Mask:</label>
                    <select id="mask-selector" name="mask-selector">
                        <option value="img/mask.png">Default Mask (mask.png)</option>
                        </select>
                </div>

                <div class="footer-input"> <div class="footer-flex">
                        <div class="weakness-selector type-selector">
                            <p class="weakness-label">Weakness:</p>
                            <div id="weakness-dropdown" class="dropdown-container weakness-dropdown"> <div class="current-type">
                                    <div id="current-weakness"> </div>
                                    <ul id="weakness-list" class="dropdown"> <li value="" class="weakness-type"></li> <li value="grass" class="weakness-type"><img src="img/grass.png" alt="grass"></li>
                                        <li value="water" class="weakness-type"><img src="img/water.png" alt="water"></li> <li value="fire" class="weakness-type"><img src="img/fire.png" alt="fire"></li>
                                        <li value="normal" class="weakness-type"><img src="img/normal.png" alt="normal"></li> <li value="electric" class="weakness-type"><img src="img/electric.png" alt="electric"></li>
                                        <li value="psychic" class="weakness-type"><img src="img/psychic.png" alt="psychic"></li> <li value="fighting" class="weakness-type"><img src="img/fighting.png" alt="fighting"></li>
                                        <li value="dark" class="weakness-type"><img src="img/dark.png" alt="dark"></li> <li value="metal" class="weakness-type"><img src="img/metal.png" alt="metal"></li>
                                    </ul>
                                </div>
                                <div class="arrowbox" id="weakness-button"> <i id="weakness-arrow" class="arrow down"></i> </div>
                            </div>
                        </div>
                        <div class="resistance-selector type-selector"> <p class="resistance-label">Resistance:</p> <div id="resistance-dropdown" class="dropdown-container resistance-dropdown">
                                <div id="resistance_onclick" class="current-type">
                                    <div id="current-resistance"> </div>
                                    <ul id="resistance-list" class="dropdown"> <li value="" class="resistance-type"></li>
                                        <li value="grass" class="resistance-type"><img src="img/grass.png" alt="grass"></li> <li value="water" class="resistance-type"><img src="img/water.png" alt="water"></li>
                                        <li value="fire" class="resistance-type"><img src="img/fire.png" alt="fire"></li> <li value="normal" class="resistance-type"><img src="img/normal.png" alt="normal"></li>
                                        <li value="electric" class="resistance-type"><img src="img/electric.png" alt="electric"></li> <li value="psychic" class="resistance-type"><img src="img/psychic.png" alt="psychic"></li>
                                        <li value="fighting" class="resistance-type"><img src="img/fighting.png" alt="fighting"></li>
                                        <li value="dark" class="resistance-type"><img src="img/dark.png" alt="dark"></li> <li value="metal" class="resistance-type"><img src="img/metal.png" alt="metal"></li>
                                    </ul>
                                </div>
                                <div class="arrowbox" id="resistance-button"> <i id="resistance-arrow" class="arrow down"></i> </div>
                            </div>
                        </div>
                        <div> <label for="retreat">Retreat:</label>
                            <select id="retreat" name="retreat">
                                <option value="0">0</option> <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option> <option value="4">4</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div id="abilities-section"> <div class="ability-input">
                    <div id="ability-dropdown" class="input-header"> <h2>Ability:</h2>
                        <div class="arrowbox">
                            <i id="ability-arrow" class="arrow down"></i> </div>
                    </div>
                    <div id="ability-body" class="input-body"> <div> <label for="ability-name">Name:</label>
                            <input type="text" id="ability-name" name="ability-name"><br>
                        </div>
                        <div> <label for="ability-text">Ability Text:</label><br>
                            <textarea id="ability-text" name="ability-text" rows="4" cols="40"></textarea><br>
                        </div>
                    </div>
                </div>
            </div>

            <div id="attacks-section"> <div class="attack-input">
                    <div id="attack-1-dropdown" class="input-header"> <h2>Attack 1:</h2>
                        <div class="arrowbox">
                            <i id="attack-1-arrow" class="arrow down"></i> </div>
                    </div>
                    <div id="attack1" class="attack-body input-body"> <div> <label for="attack1-name">Name:</label>
                            <input type="text" id="attack1-name" name="attack1-name" maxlength="20">
                            <div class="damage-container"> <label for="attack-damage-1">Damage:</label>
                                <input type="number" id="attack-damage-1" name="attack-damage-1" min="10" max="500" step="10">
                            </div>
                        </div>
                        <div class="attack-cost-container"> <div class="attacks-selector type-selector"> <p class="attack-1-label">Cost:</p>
                                <div id="attack-1-cost-1" class="dropdown-container attack-dropdown"> <div class="current-type">
                                        <div id="current-cost-1-1"></div> <ul id="attack-cost-list-1-1" class="dropdown"> <li value="" class="cost-1-1"></li>
                                            <li value="grass" class="cost-1-1"><img src="img/grass.png" alt="grass"></li> <li value="water" class="cost-1-1"><img src="img/water.png" alt="water"></li>
                                            <li value="fire" class="cost-1-1"><img src="img/fire.png" alt="fire"></li> <li value="normal" class="cost-1-1"><img src="img/normal.png" alt="normal"></li>
                                            <li value="electric" class="cost-1-1"><img src="img/electric.png" alt="electric"></li> <li value="psychic" class="cost-1-1"><img src="img/psychic.png" alt="psychic"></li>
                                            <li value="fighting" class="cost-1-1"><img src="img/fighting.png" alt="fighting"></li> <li value="dark" class="cost-1-1"><img src="img/dark.png" alt="dark"></li>
                                            <li value="metal" class="cost-1-1"><img src="img/metal.png" alt="metal"></li> <li value="no-cost" class="cost-1-1"><img src="img/energy/no-cost-energy.png" alt="no_cost"></li>
                                        </ul>
                                    </div>
                                    <div class="arrowbox" id="attack-1-cost-1-button"> <i id="attack-1-1-arrow" class="arrow down"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="attacks-selector type-selector"> <div id="attack-1-cost-2" class="dropdown-container attack-dropdown">
                                    <div class="current-type">
                                        <div id="current-cost-1-2"></div> <ul id="attack-cost-list-1-2" class="dropdown"> <li value="" class="cost-1-2"></li>
                                            <li value="grass" class="cost-1-2"><img src="img/grass.png" alt="grass"></li> <li value="water" class="cost-1-2"><img src="img/water.png" alt="water"></li>
                                            <li value="fire" class="cost-1-2"><img src="img/fire.png" alt="fire"></li> <li value="normal" class="cost-1-2"><img src="img/normal.png" alt="normal"></li>
                                            <li value="electric" class="cost-1-2"><img src="img/electric.png" alt="electric"></li> <li value="psychic" class="cost-1-2"><img src="img/psychic.png" alt="psychic"></li>
                                            <li value="fighting" class="cost-1-2"><img src="img/fighting.png" alt="fighting"></li> <li value="dark" class="cost-1-2"><img src="img/dark.png" alt="dark"></li>
                                            <li value="metal" class="cost-1-2"><img src="img/metal.png" alt="metal"></li> <li value="no-cost" class="cost-1-2"><img src="img/energy/no-cost-energy.png" alt="no_cost"></li>
                                        </ul>
                                    </div>
                                    <div class="arrowbox" id="attack-1-cost-2-button"> <i id="attack-1-2-arrow" class="arrow down"></i>
                                    </div>
                                </div>
                            </div>
                             <div class="attacks-selector type-selector"> <div id="attack-1-cost-3" class="dropdown-container attack-dropdown">
                                    <div class="current-type">
                                        <div id="current-cost-1-3"></div> <ul id="attack-cost-list-1-3" class="dropdown"> <li value="" class="cost-1-3"></li>
                                            <li value="grass" class="cost-1-3"><img src="img/grass.png" alt="grass"></li> <li value="water" class="cost-1-3"><img src="img/water.png" alt="water"></li>
                                            <li value="fire" class="cost-1-3"><img src="img/fire.png" alt="fire"></li> <li value="normal" class="cost-1-3"><img src="img/normal.png" alt="normal"></li>
                                            <li value="electric" class="cost-1-3"><img src="img/electric.png" alt="electric"></li> <li value="psychic" class="cost-1-3"><img src="img/psychic.png" alt="psychic"></li>
                                            <li value="fighting" class="cost-1-3"><img src="img/fighting.png" alt="fighting"></li> <li value="dark" class="cost-1-3"><img src="img/dark.png" alt="dark"></li>
                                            <li value="metal" class="cost-1-3"><img src="img/metal.png" alt="metal"></li> <li value="no-cost" class="cost-1-3"><img src="img/energy/no-cost-energy.png" alt="no_cost"></li>
                                        </ul>
                                    </div>
                                    <div class="arrowbox" id="attack-1-cost-3-button"> <i id="attack-1-3-arrow" class="arrow down"></i>
                                    </div>
                                </div>
                            </div>
                             <div class="attacks-selector type-selector"> <div id="attack-1-cost-4" class="dropdown-container attack-dropdown">
                                    <div class="current-type">
                                        <div id="current-cost-1-4"></div> <ul id="attack-cost-list-1-4" class="dropdown"> <li value="" class="cost-1-4"></li>
                                            <li value="grass" class="cost-1-4"><img src="img/grass.png" alt="grass"></li> <li value="water" class="cost-1-4"><img src="img/water.png" alt="water"></li>
                                            <li value="fire" class="cost-1-4"><img src="img/fire.png" alt="fire"></li> <li value="normal" class="cost-1-4"><img src="img/normal.png" alt="normal"></li>
                                            <li value="electric" class="cost-1-4"><img src="img/electric.png" alt="electric"></li> <li value="psychic" class="cost-1-4"><img src="img/psychic.png" alt="psychic"></li>
                                            <li value="fighting" class="cost-1-4"><img src="img/fighting.png" alt="fighting"></li> <li value="dark" class="cost-1-4"><img src="img/dark.png" alt="dark"></li>
                                            <li value="metal" class="cost-1-4"><img src="img/metal.png" alt="metal"></li> <li value="no-cost" class="cost-1-4"><img src="img/energy/no-cost-energy.png" alt="no_cost"></li>
                                        </ul>
                                    </div>
                                    <div class="arrowbox" id="attack-1-cost-4-button"> <i id="attack-1-4-arrow" class="arrow down"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div> <label for="attack-text-1">Attack Text:</label><br>
                            <textarea id="attack-text-1" name="attack-text-1" rows="4" cols="40"></textarea><br>
                        </div>
                    </div>
                </div>

                <div class="attack-input"> <div id="attack-2-dropdown" class="input-header">
                        <h2>Attack 2:</h2>
                        <div class="arrowbox"> <i id="attack-2-arrow" class="arrow down"></i>
                        </div>
                    </div>
                    <div id="attack2" class="attack-body input-body"> <div>
                            <label for="attack2-name">Name:</label>
                            <input type="text" id="attack2-name" name="attack2-name" maxlength="20"> <div class="damage-container">
                                <label for="attack-damage-2">Damage:</label>
                                <input type="number" id="attack-damage-2" name="attack-damage-2" min="10" max="500" step="10"> </div>
                        </div>
                        <div class="attack-cost-container"> <div class="attacks-selector type-selector">
                                <p class="attack-2-label">Cost:</p> <div id="attack-2-cost-1" class="dropdown-container attack-dropdown">
                                    <div class="current-type type-closed"> <div id="current-cost-2-1"></div>
                                        <ul id="attack-cost-list-2-1" class="dropdown"> <li value="" class="cost-2-1"></li> <li value="grass" class="cost-2-1"><img src="img/grass.png" alt="grass"></li>
                                            <li value="water" class="cost-2-1"><img src="img/water.png" alt="water"></li> <li value="fire" class="cost-2-1"><img src="img/fire.png" alt="fire"></li>
                                            <li value="normal" class="cost-2-1"><img src="img/normal.png" alt="normal"></li> <li value="electric" class="cost-2-1"><img src="img/electric.png" alt="electric"></li>
                                            <li value="psychic" class="cost-2-1"><img src="img/psychic.png" alt="psychic"></li> <li value="fighting" class="cost-2-1"><img src="img/fighting.png" alt="fighting"></li>
                                            <li value="dark" class="cost-2-1"><img src="img/dark.png" alt="dark"></li> <li value="metal" class="cost-2-1"><img src="img/metal.png" alt="metal"></li>
                                            <li value="no-cost" class="cost-2-1"><img src="img/energy/no-cost-energy.png" alt="no_cost"></li> </ul>
                                    </div>
                                    <div class="arrowbox" id="attack-2-cost-1-button">
                                        <i id="attack-2-1-arrow" class="arrow down"></i> </div>
                                </div>
                            </div>
                            <div class="attacks-selector type-selector"> <div id="attack-2-cost-2" class="dropdown-container attack-dropdown">
                                    <div class="current-type type-closed"> <div id="current-cost-2-2">
                                        </div> <ul id="attack-cost-list-2-2" class="dropdown"> <li value="" class="cost-2-2"></li>
                                            <li value="grass" class="cost-2-2"><img src="img/grass.png" alt="grass"></li>
                                            <li value="water" class="cost-2-2"><img src="img/water.png" alt="water"></li> <li value="fire" class="cost-2-2"><img src="img/fire.png" alt="fire"></li>
                                            <li value="normal" class="cost-2-2"><img src="img/normal.png" alt="normal"></li> <li value="electric" class="cost-2-2"><img src="img/electric.png" alt="electric"></li>
                                            <li value="psychic" class="cost-2-2"><img src="img/psychic.png" alt="psychic"></li> <li value="fighting" class="cost-2-2"><img src="img/fighting.png" alt="fighting"></li>
                                            <li value="dark" class="cost-2-2"><img src="img/dark.png" alt="dark"></li> <li value="metal" class="cost-2-2"><img src="img/metal.png" alt="metal"></li>
                                            <li value="no-cost" class="cost-2-2"><img src="img/energy/no-cost-energy.png" alt="no_cost"></li> </ul>
                                    </div>
                                    <div class="arrowbox" id="attack-2-cost-2-button">
                                        <i id="attack-2-2-arrow" class="arrow down"></i> </div>
                                </div>
                            </div>
                            <div class="attacks-selector type-selector"> <div id="attack-2-cost-3" class="dropdown-container attack-dropdown">
                                    <div class="current-type type-closed"> <div id="current-cost-2-3">
                                        </div> <ul id="attack-cost-list-2-3" class="dropdown"> <li value="" class="cost-2-3"></li>
                                            <li value="grass" class="cost-2-3"><img src="img/grass.png" alt="grass"></li> <li value="water" class="cost-2-3"><img src="img/water.png" alt="water"></li>
                                            <li value="fire" class="cost-2-3"><img src="img/fire.png" alt="fire"></li> <li value="normal" class="cost-2-3"><img src="img/normal.png" alt="normal"></li>
                                            <li value="electric" class="cost-2-3"><img src="img/electric.png" alt="electric"></li> <li value="psychic" class="cost-2-3"><img src="img/psychic.png" alt="psychic"></li>
                                            <li value="fighting" class="cost-2-3"><img src="img/fighting.png" alt="fighting"></li> <li value="dark" class="cost-2-3"><img src="img/dark.png" alt="dark"></li>
                                            <li value="metal" class="cost-2-3"><img src="img/metal.png" alt="metal"></li> <li value="no-cost" class="cost-2-3"><img src="img/energy/no-cost-energy.png" alt="no_cost"></li>
                                        </ul>
                                    </div>
                                    <div class="arrowbox" id="attack-2-cost-3-button">
                                        <i id="attack-2-3-arrow" class="arrow down"></i> </div>
                                </div>
                            </div>
                            <div class="attacks-selector type-selector"> <div id="attack-2-cost-4" class="dropdown-container attack-dropdown">
                                    <div class="current-type type-closed"> <div id="current-cost-2-4">
                                        </div> <ul id="attack-cost-list-2-4" class="dropdown"> <li value="" class="cost-2-4"></li>
                                            <li value="grass" class="cost-2-4"><img src="img/grass.png" alt="grass"></li>
                                            <li value="water" class="cost-2-4"><img src="img/water.png" alt="water"></li> <li value="fire" class="cost-2-4"><img src="img/fire.png" alt="fire"></li>
                                            <li value="normal" class="cost-2-4"><img src="img/normal.png" alt="normal"></li> <li value="electric" class="cost-2-4"><img src="img/electric.png" alt="electric"></li>
                                            <li value="psychic" class="cost-2-4"><img src="img/psychic.png" alt="psychic"></li> <li value="fighting" class="cost-2-4"><img src="img/fighting.png" alt="fighting"></li>
                                            <li value="dark" class="cost-2-4"><img src="img/dark.png" alt="dark"></li> <li value="metal" class="cost-2-4"><img src="img/metal.png" alt="metal"></li>
                                            <li value="no-cost" class="cost-2-4"><img src="img/energy/no-cost-energy.png" alt="no_cost"></li> </ul>
                                    </div>
                                    <div class="arrowbox" id="attack-2-cost-4-button">
                                        <i id="attack-2-4-arrow" class="arrow down"></i> </div>
                                </div>
                            </div>
                        </div>
                        <div> <label for="attack-text-2">Attack Text:</label><br>
                            <textarea id="attack-text-2" name="attack-text-2" rows="4" cols="40"></textarea><br>
                        </div>
                    </div>
                </div>
            </div>

            <div id="gallery-section"> <h3>Your Saved Cards</h3> <div class="card-gallery" id="saved-cards-gallery"> <div class="no-cards-message">No saved cards yet. Create and save a card to see it here!</div> </div>
            </div>

            <div id="templates-section"> <h3>Card Templates</h3> <p>Click a template to quickly start with a pre-configured card.</p>
                <div class="template-selection">
                    <div class="card-template" data-template="charizard"> <img src="img/templates/charizard.jpg" alt="Charizard Template"> <p>Fire Type</p>
                    </div>
                    <div class="card-template" data-template="blastoise"> <img src="img/templates/blastoise.jpg" alt="Blastoise Template">
                        <p>Water Type</p>
                    </div>
                    <div class="card-template" data-template="venusaur"> <img src="img/templates/venusaur.jpg" alt="Venusaur Template">
                        <p>Grass Type</p>
                    </div>
                    <div class="card-template" data-template="pikachu"> <img src="img/templates/pikachu.jpg" alt="Pikachu Template">
                        <p>Electric Type</p>
                    </div>
                    <div class="card-template" data-template="mewtwo"> <img src="img/templates/mewtwo.jpg" alt="Mewtwo Template">
                        <p>Psychic Type</p>
                    </div>
                    <div class="card-template" data-template="dual"> <img src="img/templates/dual-type.jpg" alt="Dual Type Template">
                        <p>Dual Type</p> </div>
                </div>
            </div>

            <button id="reload" onclick="location.reload()"><p>↻</p></button> </div>

        <div class="img-container">
            <div class="card-img"></div> <div class="card" id="card"> <div class="card-container"> <div class="card-top"> <div class="card-header">
                            <h1 class="card-name"></h1> <div class="hp-container">
                                <h2 class="card-hp"></h2> <h1 class="hp"></h1> </div>
                        </div>
                        <div class="card-picture"> <div class="small-img"></div> <p class="evolves-from"><span id="evolves-from-name"></span></p> </div>
                        <div class="stats-text"> <p class="pokedex-number"></p> <p class="category"></p> <p class="height"></p>
                            <p class="weight"></p>
                        </div>
                    </div>
                    <div class="card-bottom"> <div class="attack-container"></div> <div class="card-footer"> <div class="footer-bar"> <div class="weakness">
                                    <div id="weakness-img"></div> <p class="weakness-number"></p> </div>
                                <div class="resistance"> <div id="resistance-img"></div> <p class="resistance-number"></p>
                                </div>
                                <div id="retreat-img"></div> </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="img-drop-container">
            <div class="img-drop"> Drop Pokémon image here.
            </div>
            <div class="img-drop-small"> Drop pre-evolution image here.
            </div>

            <div class="action-buttons"> <button id="download-card-btn" class="action-button download-btn">Download Card</button> <button id="share-card" class="action-button">Share Card</button>
                <button id="save-to-gallery" class="action-button">Save to Gallery</button>
            </div>
            </div>

        <img id="pokeball" src="img/pokeball.png" alt=""> </div>

    <div id="share-modal" class="modal" style="display: none;"> <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Share Your Card</h2>
            <p>Copy this link to share your card:</p> <div class="share-link-container">
                <input type="text" id="share-link" readonly>
                <button id="copy-link" class="action-button">Copy</button> </div>
            <div class="social-share-buttons"> <button class="social-share" data-platform="twitter">Twitter</button> <button class="social-share" data-platform="facebook">Facebook</button>
                <button class="social-share" data-platform="pinterest">Pinterest</button>
            </div>
        </div>
    </div>

    <script>
        // Removed Tab interface functionality JS

        document.addEventListener('DOMContentLoaded', function() {
            // Holographic effect toggle (kept from original)
            const holoToggle = document.getElementById('holo-effect');
            if (holoToggle) {
                holoToggle.addEventListener('change', function() {
                    const card = document.getElementById('card');
                    if (this.checked) {
                        card.classList.add('holographic');
                    } else {
                        card.classList.remove('holographic'); // [cite: 341]
                    }
                });
            }

            // Card templates (kept from original)
            const cardTemplates = document.querySelectorAll('.card-template');
            cardTemplates.forEach(template => {
                template.addEventListener('click', function() {
                    const templateName = this.getAttribute('data-template'); // [cite: 343]
                    loadCardTemplate(templateName);
                });
            });

            // Share button (kept from original)
            const shareButton = document.getElementById('share-card'); // [cite: 344]
            const shareModal = document.getElementById('share-modal');
            const closeModal = document.querySelector('.close-modal');
            const copyLinkButton = document.getElementById('copy-link'); // [cite: 345]
            if (shareButton && shareModal) {
                shareButton.addEventListener('click', function() {
                    const cardData = generateCardData();
                    const shareLink = generateShareLink(cardData);
                    document.getElementById('share-link').value = shareLink; // [cite: 347]
                    shareModal.style.display = 'block';
                });
                closeModal.addEventListener('click', function() { // [cite: 348]
                    shareModal.style.display = 'none';
                });
                copyLinkButton.addEventListener('click', function() { // [cite: 349]
                    const shareLinkInput = document.getElementById('share-link');
                    shareLinkInput.select();
                    try {
                      document.execCommand('copy');
                      this.textContent = 'Copied!';
                    } catch (err) {
                      console.error('Failed to copy link:', err);
                      this.textContent = 'Error';
                    }
                    setTimeout(() => { // [cite: 350]
                        this.textContent = 'Copy';
                    }, 2000);
                });
                window.addEventListener('click', function(event) { // [cite: 351]
                    if (event.target === shareModal) {
                        shareModal.style.display = 'none';
                    }
                });
            }

            // Save to gallery button (kept from original)
            const saveToGalleryButton = document.getElementById('save-to-gallery'); // [cite: 352]
            if (saveToGalleryButton) {
                saveToGalleryButton.addEventListener('click', function() { // [cite: 353]
                    saveCardToGallery();
                });
            }

            // Social share buttons (kept from original)
            const socialShareButtons = document.querySelectorAll('.social-share'); // [cite: 354]
            socialShareButtons.forEach(button => {
                button.addEventListener('click', function() { // [cite: 355]
                    const platform = this.getAttribute('data-platform');
                    const shareLink = document.getElementById('share-link').value;
                    const cardName = document.querySelector('.card-name').textContent || 'Pokémon Card'; // [cite: 355]

                    let url;
                    switch(platform) {
                        case 'twitter':
                            url = `https://twitter.com/intent/tweet?text=Check out my custom ${cardName} card!&url=${encodeURIComponent(shareLink)}`; // [cite: 357]
                            break;
                        case 'facebook':
                            url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareLink)}`; // [cite: 357]
                            break;
                        case 'pinterest':
                            url = `https://pinterest.com/pin/create/button/?url=${encodeURIComponent(shareLink)}&description=Custom ${cardName} Pokémon Card`; // [cite: 359]
                            break;
                    }
                    if (url) window.open(url, '_blank'); // [cite: 360]
                });
            });

            // Local storage functionality (kept from original)
            const saveProgressButton = document.getElementById('save-progress');
            const loadProgressButton = document.getElementById('load-progress'); // [cite: 361]

            if (saveProgressButton && loadProgressButton) {
                saveProgressButton.addEventListener('click', function() {
                    const cardData = generateCardData();
                    localStorage.setItem('savedCardData', JSON.stringify(cardData));
                    alert('Card progress saved successfully!'); // [cite: 361]
                });
                loadProgressButton.addEventListener('click', function() { // [cite: 363]
                    const savedData = localStorage.getItem('savedCardData');
                    if (savedData) {
                        loadCardData(JSON.parse(savedData));
                        alert('Card loaded successfully!'); // [cite: 363]
                    } else {
                        alert('No saved card found.'); // [cite: 364]
                    }
                });
            }

            // Export/Import functionality (kept from original)
            const exportDataButton = document.getElementById('export-data');
            const importDataButton = document.getElementById('import-data'); // [cite: 366]

            if (exportDataButton && importDataButton) {
                exportDataButton.addEventListener('click', function() {
                    const cardData = generateCardData();
                    const dataStr = JSON.stringify(cardData);
                    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr); // [cite: 366]

                    const exportLink = document.createElement('a');
                    exportLink.setAttribute('href', dataUri);
                    exportLink.setAttribute('download', 'pokemon-card.json'); // [cite: 367]
                    document.body.appendChild(exportLink); // [cite: 368]
                    exportLink.click();
                    document.body.removeChild(exportLink); // [cite: 368]
                });
                importDataButton.addEventListener('click', function() { // [cite: 369]
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.accept = '.json'; // [cite: 369]

                    input.onchange = e => { // [cite: 370]
                        const file = e.target.files[0];
                        const reader = new FileReader(); // [cite: 370]

                        reader.onload = function(event) { // [cite: 371]
                            try {
                                const cardData = JSON.parse(event.target.result);
                                loadCardData(cardData); // [cite: 372]
                                alert('Card data imported successfully!');
                            } catch (error) {
                                alert('Error importing card data. Please check your file.'); // [cite: 373]
                                console.error(error);
                            }
                        };

                        reader.readAsText(file); // [cite: 375]
                    };

                    input.click();
                });
            }

            // Reset card button (kept from original)
            const resetCardButton = document.getElementById('reset-card'); // [cite: 375]
            if (resetCardButton) {
                resetCardButton.addEventListener('click', function() { // [cite: 376]
                    if (confirm('Are you sure you want to reset the card? All unsaved changes will be lost.')) {
                        resetCard(); // [cite: 376]
                    }
                });
            }

            // Check URL for shared card (kept from original)
            checkForSharedCard(); // [cite: 379]
            // Populate gallery (kept from original)
            populateGallery(); // [cite: 379]
        });

        // Kept functions (generateCardData, loadCardData, resetCard, loadCardTemplate, etc.)
        // from the original provided script section, as they are needed for
        // the functionality of buttons like save, load, templates, export/import, reset.
        // Minor modifications might be needed in loadCardData for dual-type/mask later.
        function generateCardData() {
            const cardData = {
                name: document.getElementById('name').value, // [cite: 380]
                hp: document.getElementById('hp').value,
                type: document.querySelector('.select-type.highlight')?.getAttribute('value') || '', // [cite: 380]
                stage: document.getElementById('stage').value,
                evolvesFrom: document.getElementById('evolves-from').value, // [cite: 381]
                category: document.getElementById('category').value,
                pokedexNumber: document.getElementById('pokedex-number').value,
                height: {
                    feet: document.getElementById('feet').value, // [cite: 382]
                    inches: document.getElementById('inches').value
                },
                weight: document.getElementById('weight').value,
                abilityName: document.getElementById('ability-name').value,
                abilityText: document.getElementById('ability-text').value, // [cite: 382]
                attacks: [ // [cite: 383]
                    {
                        name: document.getElementById('attack1-name').value,
                        damage: document.getElementById('attack-damage-1').value,
                        text: document.getElementById('attack-text-1').value, // [cite: 384]
                        costs: window.attackCosts?.attack1 || ['', '', '', ''] // Use global attackCosts if available
                    },
                    {
                        name: document.getElementById('attack2-name').value,
                        damage: document.getElementById('attack-damage-2').value, // [cite: 385]
                        text: document.getElementById('attack-text-2').value,
                        costs: window.attackCosts?.attack2 || ['', '', '', '']
                    }
                ],
                weakness: window.weakness || '', // Use global // [cite: 386]
                resistance: window.resistance || '', // Use global
                retreat: document.getElementById('retreat').value,
                dualType: window.isDualType || false, // Use global // [cite: 386]
                secondType: window.secondType || '', // Use global
                holographic: document.getElementById('holo-effect')?.checked || false, // [cite: 387]
            };
            return cardData; // [cite: 389]
        }

         function loadCardData(cardData) {
            document.getElementById('name').value = cardData.name || ''; // [cite: 389]
            document.getElementById('hp').value = cardData.hp || ''; // [cite: 390]

            if (cardData.type) {
                const typeElement = document.querySelector(`.select-type[value="${cardData.type}"]`);
                if (typeElement) { // [cite: 391]
                    updateType(typeElement);
                }
            }

            if (cardData.dualType) {
                const dualTypeToggle = document.getElementById('dual-type-toggle');
                if (dualTypeToggle) { // [cite: 393]
                    dualTypeToggle.checked = true;
                    window.isDualType = true; // [cite: 394]

                    const secondTypeSelector = document.getElementById('second-type-selector');
                    if (secondTypeSelector) { // [cite: 395]
                        secondTypeSelector.classList.remove('hidden');
                    }

                    if (cardData.secondType) {
                        const secondTypeElement = document.querySelector(`.select-second-type[value="${cardData.secondType}"]`);
                        if (secondTypeElement) { // [cite: 397]
                            window.secondType = cardData.secondType;
                            document.querySelectorAll('.select-second-type').forEach(el => { // [cite: 398]
                                el.classList.remove('highlight');
                            });
                            secondTypeElement.classList.add('highlight'); // [cite: 399]
                            if (typeof window.dualTypeSimple !== 'undefined') {
                                window.dualTypeSimple.updateSecondLayer(); // [cite: 400]
                            }
                        }
                    }
                }
            } else {
                 const dualTypeToggle = document.getElementById('dual-type-toggle');
                 if (dualTypeToggle) dualTypeToggle.checked = false;
                 window.isDualType = false;
                 const secondTypeSelector = document.getElementById('second-type-selector');
                 if (secondTypeSelector) secondTypeSelector.classList.add('hidden');
                 if (typeof window.dualTypeSimple !== 'undefined') {
                     window.dualTypeSimple.removeSecondLayer(); // Ensure layer is removed
                 }
            }
             // ADDED: Load Mask
             if (cardData.mask) {
                 const maskSelector = document.getElementById('mask-selector');
                 if (maskSelector) {
                     maskSelector.value = cardData.mask;
                     // Trigger mask update (assuming a function exists or will be created)
                     if (typeof updateMaskDisplay === 'function') {
                         updateMaskDisplay(cardData.mask);
                     }
                 }
             }


            document.getElementById('stage').value = cardData.stage || 'basic'; // [cite: 402]
            document.getElementById('evolves-from').value = cardData.evolvesFrom || ''; // [cite: 403]

            document.getElementById('category').value = cardData.category || ''; // [cite: 404]
            document.getElementById('pokedex-number').value = cardData.pokedexNumber || '';
            document.getElementById('feet').value = cardData.height?.feet || '';
            document.getElementById('inches').value = cardData.height?.inches || '';
            document.getElementById('weight').value = cardData.weight || ''; // [cite: 404]
            document.getElementById('ability-name').value = cardData.abilityName || ''; // [cite: 405]
            document.getElementById('ability-text').value = cardData.abilityText || ''; // [cite: 406]

            document.getElementById('attack1-name').value = cardData.attacks[0]?.name || ''; // [cite: 406]
            document.getElementById('attack-damage-1').value = cardData.attacks[0]?.damage || '';
            document.getElementById('attack-text-1').value = cardData.attacks[0]?.text || ''; // [cite: 407]

            document.getElementById('attack2-name').value = cardData.attacks[1]?.name || '';
            document.getElementById('attack-damage-2').value = cardData.attacks[1]?.damage || ''; // [cite: 407]
            document.getElementById('attack-text-2').value = cardData.attacks[1]?.text || ''; // [cite: 408]

            // Load attack costs and update display
            window.attackCosts = cardData.attacks.reduce((acc, attack, index) => {
                const key = `attack${index + 1}`;
                acc[key] = attack.costs || ['', '', '', ''];
                for (let i = 1; i <= 4; i++) {
                     const costImgElement = document.getElementById(`current-cost-${index + 1}-${i}`);
                     const value = acc[key][i-1];
                     const costList = document.getElementById(`attack-cost-list-${index + 1}-${i}`);
                     if(costImgElement && costList) {
                        dropdownUpdate(costImgElement, costList, value); // Update display for each cost
                     }
                }
                return acc;
            }, { attack1: ['', '', '', ''], attack2: ['', '', '', ''] });


            window.weakness = cardData.weakness || ''; // [cite: 410]
            window.resistance = cardData.resistance || ''; // [cite: 411]
            document.getElementById('retreat').value = cardData.retreat || '0'; // [cite: 411]

             // Load and update weakness/resistance display
            const weaknessList = document.getElementById('weakness-list');
            const weaknessImg = document.getElementById('current-weakness');
            const resistanceList = document.getElementById('resistance-list');
            const resistanceImg = document.getElementById('current-resistance');

            if(weaknessList && weaknessImg) dropdownUpdate(weaknessImg, weaknessList, window.weakness);
            if(resistanceList && resistanceImg) dropdownUpdate(resistanceImg, resistanceList, window.resistance);


            const holoToggle = document.getElementById('holo-effect'); // [cite: 412]
            if (holoToggle) {
                holoToggle.checked = cardData.holographic || false; // [cite: 414]
                const cardElement = document.getElementById('card');
                if (cardData.holographic) {
                    cardElement?.classList.add('holographic'); // [cite: 415]
                } else {
                    cardElement?.classList.remove('holographic'); // [cite: 415]
                }
            }

            updateContent(); // [cite: 417]
        }

        function resetCard() {
            document.querySelectorAll('input[type="text"], input[type="number"], textarea').forEach(input => { // [cite: 418]
                input.value = '';
            });
            document.getElementById('stage').value = 'basic'; // [cite: 418]
            document.getElementById('retreat').value = '0'; // [cite: 419]
            document.querySelectorAll('.select-type, .select-second-type').forEach(typeEl => { // [cite: 419]
                typeEl.classList.remove('highlight');
            });
            const dualTypeToggle = document.getElementById('dual-type-toggle'); // [cite: 420]
            if (dualTypeToggle) {
                dualTypeToggle.checked = false; // [cite: 421]
                const secondTypeSelector = document.getElementById('second-type-selector'); // [cite: 422]
                if (secondTypeSelector) {
                    secondTypeSelector.classList.add('hidden'); // [cite: 422]
                }
            }
            window.isDualType = false; // [cite: 424]
            window.secondType = '';
            window.weakness = ''; // [cite: 424]
            window.resistance = '';
            window.attackCosts = { // [cite: 424]
                attack1: ['', '', '', ''],
                attack2: ['', '', '', '']
            };
             // Clear mask selector
            const maskSelector = document.getElementById('mask-selector');
            if (maskSelector) maskSelector.value = 'img/mask.png'; // Reset to default

            for (let i = 1; i <= 4; i++) {
                document.getElementById(`current-cost-1-${i}`).innerHTML = ''; // [cite: 425]
                document.getElementById(`current-cost-2-${i}`).innerHTML = ''; // [cite: 426]
            }
            document.getElementById('current-weakness').innerHTML = ''; // [cite: 426]
            document.getElementById('current-resistance').innerHTML = ''; // [cite: 427]
            const holoToggle = document.getElementById('holo-effect'); // [cite: 427]
            if (holoToggle) {
                holoToggle.checked = false; // [cite: 428]
                document.getElementById('card').classList.remove('holographic'); // [cite: 429]
            }
            document.querySelector('.card-img').innerHTML = ''; // [cite: 429]
            document.querySelector('.small-img').innerHTML = ''; // [cite: 430]
            document.querySelector('.img-drop').textContent = 'Drop Pokémon image here.'; // [cite: 430]
            document.querySelector('.img-drop-small').textContent = 'Drop pre-evolution image here.'; // [cite: 431]
            updateContent(); // [cite: 431]
        }

        function loadCardTemplate(template) { // [cite: 433]
            resetCard();
            switch(template) {
                case 'charizard': loadCharizardTemplate(); break; // [cite: 433]
                case 'blastoise': loadBlastoiseTemplate(); break; // [cite: 434]
                case 'venusaur': loadVenusaurTemplate(); break; // [cite: 435]
                case 'pikachu': loadPikachuTemplate(); break; // [cite: 436]
                case 'mewtwo': loadMewtwoTemplate(); break; // [cite: 437]
                case 'dual': loadDualTypeTemplate(); break; // [cite: 438]
            }
        }
        // Template functions (loadCharizardTemplate, etc.) remain the same
        function loadCharizardTemplate(){document.getElementById("name").value="Charizard",document.getElementById("hp").value="220";const e=document.querySelector('.select-type[value="fire"]');e&&updateType(e),document.getElementById("stage").value="stage-2",document.getElementById("evolves-from").value="Charmeleon",document.getElementById("category").value="Flame",document.getElementById("pokedex-number").value="6",document.getElementById("feet").value="5",document.getElementById("inches").value="7",document.getElementById("weight").value="199.5",document.getElementById("ability-name").value="Fire Aura",document.getElementById("ability-text").value="Once during your turn, you may attach a Fire Energy card from your hand to 1 of your Pokémon.",document.getElementById("attack1-name").value="Fire Spin",document.getElementById("attack-damage-1").value="120",document.getElementById("attack-text-1").value="Discard 2 Energy attached to this Pokémon.",document.getElementById("attack2-name").value="Inferno Wing",document.getElementById("attack-damage-2").value="220",document.getElementById("attack-text-2").value="This Pokémon does 30 damage to itself.",window.weakness="water",window.resistance="fighting",document.getElementById("retreat").value="3";const t=document.getElementById("holo-effect");t&&(t.checked=!0,document.getElementById("card").classList.add("holographic")),updateContent()} //
        function loadBlastoiseTemplate(){document.getElementById("name").value="Blastoise",document.getElementById("hp").value="210";const e=document.querySelector('.select-type[value="water"]');e&&updateType(e),document.getElementById("stage").value="stage-2",document.getElementById("evolves-from").value="Wartortle",document.getElementById("category").value="Shellfish",document.getElementById("pokedex-number").value="9",document.getElementById("feet").value="5",document.getElementById("inches").value="3",document.getElementById("weight").value="188.5",document.getElementById("ability-name").value="Deluge",document.getElementById("ability-text").value="As often as you like during your turn, you may attach a Water Energy card from your hand to 1 of your Pokémon.",document.getElementById("attack1-name").value="Hydro Pump",document.getElementById("attack-damage-1").value="130",document.getElementById("attack-text-1").value="This attack does 30 more damage for each Water Energy attached to this Pokémon beyond 3.",window.weakness="electric",window.resistance="fire",document.getElementById("retreat").value="3",updateContent()} //
        function loadVenusaurTemplate(){document.getElementById("name").value="Venusaur",document.getElementById("hp").value="230";const e=document.querySelector('.select-type[value="grass"]');e&&updateType(e),document.getElementById("stage").value="stage-2",document.getElementById("evolves-from").value="Ivysaur",document.getElementById("category").value="Seed",document.getElementById("pokedex-number").value="3",document.getElementById("feet").value="6",document.getElementById("inches").value="7",document.getElementById("weight").value="220.5",document.getElementById("ability-name").value="Forest Bloom",document.getElementById("ability-text").value="Once during your turn, you may heal 30 damage from each of your Grass Pokémon.",document.getElementById("attack1-name").value="Pollen Hazard",document.getElementById("attack-damage-1").value="120",document.getElementById("attack-text-1").value="Your opponent's Active Pokémon is now Poisoned and Confused.",document.getElementById("attack2-name").value="Solar Beam",document.getElementById("attack-damage-2").value="180",window.weakness="fire",window.resistance="water",document.getElementById("retreat").value="3",updateContent()} //
        function loadPikachuTemplate(){document.getElementById("name").value="Pikachu",document.getElementById("hp").value="80";const e=document.querySelector('.select-type[value="electric"]');e&&updateType(e),document.getElementById("stage").value="basic",document.getElementById("category").value="Mouse",document.getElementById("pokedex-number").value="25",document.getElementById("feet").value="1",document.getElementById("inches").value="4",document.getElementById("weight").value="13.2",document.getElementById("attack1-name").value="Quick Attack",document.getElementById("attack-damage-1").value="20",document.getElementById("attack-text-1").value="Flip a coin. If heads, this attack does 20 more damage.",document.getElementById("attack2-name").value="Thunderbolt",document.getElementById("attack-damage-2").value="90",document.getElementById("attack-text-2").value="Discard all Energy attached to this Pokémon.",window.weakness="fighting",window.resistance="",document.getElementById("retreat").value="1",updateContent()} //
        function loadMewtwoTemplate(){document.getElementById("name").value="Mewtwo",document.getElementById("hp").value="190";const e=document.querySelector('.select-type[value="psychic"]');e&&updateType(e),document.getElementById("stage").value="basic",document.getElementById("category").value="Genetic",document.getElementById("pokedex-number").value="150",document.getElementById("feet").value="6",document.getElementById("inches").value="7",document.getElementById("weight").value="269",document.getElementById("ability-name").value="Psyshield",document.getElementById("ability-text").value="Prevent all effects of your opponent's Pokémon's Abilities done to this Pokémon.",document.getElementById("attack1-name").value="Psystrike",document.getElementById("attack-damage-1").value="150",document.getElementById("attack-text-1").value="Discard an Energy from your hand. If you can't discard an Energy card from your hand, this attack does nothing.",window.weakness="dark",window.resistance="fighting",document.getElementById("retreat").value="2",updateContent()} //
        function loadDualTypeTemplate(){document.getElementById("name").value="Charizard-GX",document.getElementById("hp").value="250";const e=document.querySelector('.select-type[value="fire"]');e&&updateType(e);const t=document.getElementById("dual-type-toggle");if(t){t.checked=!0,window.isDualType=!0;const e=document.getElementById("second-type-selector");e&&e.classList.remove("hidden");const o=document.querySelector('.select-second-type[value="dark"]');o&&(document.querySelectorAll(".select-second-type").forEach((e=>{el.classList.remove("highlight")})),o.classList.add("highlight"),window.secondType="dark","undefined"!=typeof window.dualTypeSimple&&window.dualTypeSimple.updateSecondLayer())}document.getElementById("stage").value="stage-2",document.getElementById("evolves-from").value="Charmeleon",document.getElementById("category").value="Flame",document.getElementById("pokedex-number").value="6",document.getElementById("feet").value="5",document.getElementById("inches").value="7",document.getElementById("weight").value="199.5",document.getElementById("ability-name").value="Burning Road",document.getElementById("ability-text").value="When you attach a Fire Energy card from your hand to this Pokémon, you may search your deck for up to 2 Fire Energy cards and attach them to this Pokémon. Then, shuffle your deck.",document.getElementById("attack1-name").value="Crimson Storm",document.getElementById("attack-damage-1").value="200",document.getElementById("attack-text-1").value="Discard 3 Energy from this Pokémon.",document.getElementById("attack2-name").value="Raging Out-GX",document.getElementById("attack-damage-2").value="300",document.getElementById("attack-text-2").value="You can't use more than 1 GX attack in a game.",window.weakness="water",window.resistance="fighting",document.getElementById("retreat").value="3";const o=document.getElementById("holo-effect");o&&(o.checked=!0,document.getElementById("card").classList.add("holographic")),updateContent()} //


        function generateShareLink(cardData) {
            const baseUrl = window.location.origin + window.location.pathname; // [cite: 520]
            const encodedData = btoa(JSON.stringify(cardData)); // [cite: 521]
            return `${baseUrl}?card=${encodedData}`; // [cite: 522]
        }

        function checkForSharedCard() {
            const urlParams = new URLSearchParams(window.location.search); // [cite: 523]
            const cardParam = urlParams.get('card'); // [cite: 524]
            if (cardParam) {
                try {
                    const cardData = JSON.parse(atob(cardParam)); // [cite: 524]
                    loadCardData(cardData); // [cite: 525]
                } catch (error) {
                    console.error('Error loading shared card:', error); // [cite: 525]
                }
            }
        }

        function saveCardToGallery() {
            html2canvas(document.getElementById('card'), { // [cite: 526]
                scale: 0.5,
                backgroundColor: null // [cite: 527]
            }).then(canvas => {
                const imageData = canvas.toDataURL('image/png'); // [cite: 527]
                const cardId = 'card_' + Date.now(); // [cite: 528]
                const cardData = generateCardData(); // [cite: 528]
                let savedCards = JSON.parse(localStorage.getItem('pokemonCardGallery')) || []; // [cite: 529]
                savedCards.push({ // [cite: 529]
                    id: cardId, // [cite: 530]
                    name: cardData.name || 'Unnamed Card',
                    preview: imageData,
                    data: cardData,
                    timestamp: Date.now()
                });
                localStorage.setItem('pokemonCardGallery', JSON.stringify(savedCards)); // [cite: 532]
                populateGallery(); // [cite: 532]
                alert('Card saved to gallery!'); // [cite: 533]
                // Optionally switch to gallery view here if it wasn't removed
            });
        }

         function populateGallery() {
            const galleryContainer = document.getElementById('saved-cards-gallery'); // [cite: 535]
            if (!galleryContainer) return;
            const savedCards = JSON.parse(localStorage.getItem('pokemonCardGallery')) || []; // [cite: 537]
            galleryContainer.innerHTML = '';
            if (savedCards.length === 0) { // [cite: 538]
                galleryContainer.innerHTML = '<div class="no-cards-message">No saved cards yet. Create and save a card to see it here!</div>'; // [cite: 539]
                return;
            }
            savedCards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = 'gallery-item';
                cardElement.setAttribute('data-card-id', card.id); // [cite: 540]
                const cardImage = document.createElement('img');
                cardImage.src = card.preview; // [cite: 541]
                cardImage.alt = card.name;
                const cardActions = document.createElement('div'); // [cite: 542]
                cardActions.className = 'gallery-item-actions';
                const loadButton = document.createElement('button');
                loadButton.className = 'gallery-action'; // [cite: 542]
                loadButton.textContent = 'Load';
                loadButton.addEventListener('click', () => { // [cite: 543]
                    loadCardData(card.data);
                     // If tabs were active, switch: document.querySelector('.tab-button[data-tab="pokemon-info"]').click();
                });
                const deleteButton = document.createElement('button');
                deleteButton.className = 'gallery-action'; // [cite: 544]
                deleteButton.textContent = 'Delete';
                deleteButton.addEventListener('click', () => { // [cite: 545]
                    if (confirm(`Are you sure you want to delete "${card.name}"?`)) {
                        deleteCardFromGallery(card.id);
                    }
                });
                cardActions.appendChild(loadButton); // [cite: 546]
                cardActions.appendChild(deleteButton);
                cardElement.appendChild(cardImage);
                cardElement.appendChild(cardActions);
                galleryContainer.appendChild(cardElement); // [cite: 546]
            });
        }

        function deleteCardFromGallery(cardId) {
            let savedCards = JSON.parse(localStorage.getItem('pokemonCardGallery')) || []; // [cite: 547]
            savedCards = savedCards.filter(card => card.id !== cardId); // [cite: 548]
            localStorage.setItem('pokemonCardGallery', JSON.stringify(savedCards)); // [cite: 548]
            populateGallery(); // [cite: 549]
        }

        // Holographic effect CSS (kept from original)
        const holoStyle = document.createElement('style'); // [cite: 550]
        holoStyle.textContent = `
            @keyframes holographic {
                0% { background-position: 0% 0%; } /* [cite: 551] */
                100% { background-position: 100% 100%; } /* [cite: 552] */
            }
            .holographic::before { /* [cite: 553] */
                content: '';
                position: absolute; /* [cite: 554] */
                top: 0; left: 0; width: 100%; height: 100%;
                background: linear-gradient( 125deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.1) 10%, rgba(255,255,255,0.4) 20%, rgba(255,255,255,0.2) 30%, rgba(255,255,255,0) 40%, rgba(255,255,255,0) 100% ); /* [cite: 555] */
                background-size: 200% 200%; /* [cite: 557] */
                border-radius: 4.5%; /* [cite: 557] */
                mix-blend-mode: overlay; /* [cite: 557] */
                z-index: 20; /* [cite: 557] */
                pointer-events: none; /* [cite: 557] */
                animation: holographic 5s ease infinite alternate; /* [cite: 557] */
            }
        `;
        document.head.appendChild(holoStyle); // [cite: 558]

    </script>
</body>
</html>